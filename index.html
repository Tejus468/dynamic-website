<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Crypto Tracker Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="btn btn-outline-light" id="themeToggle">
            <i class="fas fa-moon" id="themeIcon"></i>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-coins me-2"></i>CryptoTracker Pro
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/portfolio">Portfolio</a>
                <a class="nav-link" href="/export_csv">Export</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Market Overview Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="metric-info">
                        <h5>Total Coins</h5>
                        <h3>15</h3>
                        <span class="trend positive">Active</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="metric-info">
                        <h5>Market Status</h5>
                        <h3>Live</h3>
                        <span class="trend neutral">Online</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-arrow-trend-up"></i>
                    </div>
                    <div class="metric-info">
                        <h5>Trending</h5>
                        <h3>Up</h3>
                        <span class="trend positive">Today</span>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card">
                    <div class="metric-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="metric-info">
                        <h5>Last Update</h5>
                        <h3 id="lastUpdate">Now</h3>
                        <span class="trend neutral">Live</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-success alert-dismissible fade show">
                        <i class="fas fa-check-circle me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Advanced Filters -->
        <div class="advanced-filters mb-4">
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="searchInput" placeholder="Search coins...">
                </div>
                <div class="col-md-2">
                    <select class="form-control" id="sortBy">
                        <option value="rank">Sort by Rank</option>
                        <option value="price">Sort by Price</option>
                        <option value="change">Sort by Change</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <div class="price-range-container">
                        <input type="range" class="form-range" id="priceRange" min="0" max="200000" value="200000">
                        <label class="form-label">Max Price: $<span id="priceValue">200000</span></label>
                    </div>
                </div>
                <div class="col-md-2">
                    <a href="/refresh" class="btn btn-success w-100">
                        <i class="fas fa-sync-alt me-2"></i>Refresh
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Crypto Table -->
            <div class="col-md-8">
                {% if data %}
                <div class="crypto-table-container">
                    <table class="table crypto-table shadow-lg" id="cryptoTable">
                        <thead>
                            <tr>
                                <th><i class="fas fa-trophy me-2"></i>Rank</th>
                                <th><i class="fas fa-coins me-2"></i>Coin</th>
                                <th><i class="fas fa-dollar-sign me-2"></i>Price</th>
                                <th><i class="fas fa-chart-line me-2"></i>24h Change</th>
                                <th><i class="fas fa-eye me-2"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for coin in data %}
                            <tr class="table-row clickable-row" data-price="{{ coin[3] }}">
                                <td class="rank-column">{{ loop.index }}</td>
                                <td class="coin-name">
                                    <div class="coin-info">
                                        <strong>{{ coin[1] }}</strong>
                                        <small class="text-muted d-block">{{ coin[2] if coin[2] else coin[1][:3] }}</small>
                                    </div>
                                </td>
                                <td class="price-column">
                                    <strong>${{ coin[3] }}</strong>
                                </td>
                                <td class="change-column">
                                    {% if coin[4] and coin[4].startswith('-') %}
                                        <span class="badge negative">
                                            <i class="fas fa-arrow-down me-1"></i>{{ coin[4] }}
                                        </span>
                                    {% else %}
                                        <span class="badge positive">
                                            <i class="fas fa-arrow-up me-1"></i>{{ coin[4] if coin[4] else '+0%' }}
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="actions">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm btn-outline-primary" onclick="showCoinDetails('{{ coin[1] }}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="addToPortfolio('{{ coin[1] }}')">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="setAlert('{{ coin[1] }}')">
                                            <i class="fas fa-bell"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="no-data text-center py-5">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h4>No data available</h4>
                        <p>Click "Refresh" to load cryptocurrency data.</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="col-md-4">
                <!-- Crypto News -->
                <div class="news-section mb-4">
                    <h5><i class="fas fa-newspaper me-2"></i>Latest Crypto News</h5>
                    <div class="news-container">
                        <div class="news-item">
                            <h6>Bitcoin Reaches New Heights</h6>
                            <p class="text-muted">Cryptocurrency market shows strong performance</p>
                            <small class="text-secondary">2 hours ago</small>
                        </div>
                        <div class="news-item">
                            <h6>Ethereum Network Updates</h6>
                            <p class="text-muted">New improvements to transaction speed</p>
                            <small class="text-secondary">4 hours ago</small>
                        </div>
                        <div class="news-item">
                            <h6>DeFi Market Growth</h6>
                            <p class="text-muted">Decentralized finance shows expansion</p>
                            <small class="text-secondary">6 hours ago</small>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <h5><i class="fas fa-chart-pie me-2"></i>Market Stats</h5>
                    <div class="stat-item">
                        <span>Fear & Greed Index</span>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 65%">65 - Greed</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span>Market Dominance</span>
                        <small class="text-muted">BTC: 45% | ETH: 18% | Others: 37%</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Modal -->
    <div class="modal fade" id="coinModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="coinModalLabel">Coin Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    <div class="text-center">
                        <i class="fas fa-spinner fa-spin fa-3x"></i>
                        <p class="mt-3">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Simple JavaScript functions
        function showCoinDetails(coinName) {
            const modal = new bootstrap.Modal(document.getElementById('coinModal'));
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('coinModalLabel');
            
            modalTitle.textContent = coinName + ' Details';
            modal.show();
            
            fetch('/api/coin/' + coinName)
                .then(response => response.json())
                .then(data => {
                    modalBody.innerHTML = 
                        '<div class="row">' +
                        '<div class="col-md-6">' +
                        '<h4>' + data.name + '</h4>' +
                        '<p><strong>Price:</strong> $' + data.price + '</p>' +
                        '<p><strong>24h Change:</strong> ' + data.change_24h + '</p>' +
                        '</div>' +
                        '<div class="col-md-6">' +
                        '<p><strong>Market Cap:</strong> ' + data.market_cap + '</p>' +
                        '<p><strong>Volume:</strong> ' + data.volume_24h + '</p>' +
                        '</div>' +
                        '</div>';
                })
                .catch(error => {
                    modalBody.innerHTML = '<div class="alert alert-danger">Error loading details</div>';
                });
        }
        
        function addToPortfolio(coinName) {
            alert('Portfolio feature: Add ' + coinName + ' to your portfolio');
        }
        
        function setAlert(coinName) {
            alert('Alert feature: Set price alert for ' + coinName);
        }
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#cryptoTable tbody tr');
            
            rows.forEach(row => {
                const coinName = row.querySelector('.coin-info strong').textContent.toLowerCase();
                if (coinName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            
            const icon = document.getElementById('themeIcon');
            icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        });
        
        // Update timestamp
        function updateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }
        updateTime();
        setInterval(updateTime, 60000);
    </script>
</body>
</html>
